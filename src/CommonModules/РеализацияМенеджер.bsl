#Если Сервер Тогда

// Инвалидация кэша при изменении продаж
Процедура ИнвалидироватьКэшДляДаты(ДатаИзменения) Экспорт
    КлючПаттерн = "ТОП_*" + Формат(ДатаИзменения, "ДФ=dd.MM.yy") + "*";
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ Ключ ИЗ РегСвед.КэшОтчетов 
    |ГДЕ Ключ ПОДОБНО &Паттерн ДЛЯ ИЗМЕНЕНИЯ";
    Запрос.УстановитьПараметр("Паттерн", КлючПаттерн);
    Рез = Запрос.Выполнить();
    Выборка = Рез.Выбрать();
    Пока Выборка.Следующий() Цикл
        Выборка.Удалить();
    КонецЦикла;
КонецПроцедуры

// Получить продажи за период (альтернатива запросу)
Функция ПолучитьПродажиЗаПериод(Начало, Конец) Экспорт
    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    Док.Дата,
    |    Стр.Номенклатура,
    |    Стр.Количество,
    |    Стр.Сумма
    |ИЗ Док.Реализация КАК Док
    |    ВНУТРЕННЕЕ СОЕДИНЕНИЕ Док.Реализация.Товары КАК Стр
    |    ПО Стр.Ссылка = Док.Ссылка
    |ГДЕ Док.Дата МЕЖДУ &Начало И &Конец
    |    И Док.Проведен = Истина";
    
    Запрос.УстановитьПараметр("Начало", Начало);
    Запрос.УстановитьПараметр("Конец", Конец);
    
    Возврат Запрос.Выполнить().Выгрузить();
КонецФункции

#КонецЕсли
